(this["webpackJsonp"]=this["webpackJsonp"]||[]).push([[25],{"0c3f":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("q-page",{staticClass:"container q-pa-none vertical-top row justify-center items-start self-start"},[a("q-card",{staticClass:"q-pt-none",staticStyle:{width:"90%","max-width":"100%"}},[a("q-toolbar",{staticClass:"text-white full-width bg-blue"},[a("q-toolbar-title",{staticClass:"text-h5"},[e._v(" Demande d'accès Parking ! ")])],1),a("q-card-section",{staticClass:"q-pa-md",staticStyle:{width:"100%","max-width":"100%"}},[a("f-vv-form-by-name",{ref:"demandeParkingForm",staticClass:"q-pa-sm",attrs:{nameForm:"Demande Parking",fieldsmodel:{chargeaccueil:e.currentUsername,typeacces:"PARKING",etat:"attente"},showSave:!0,saveLabel:"Envoyer la demande"},on:{onFormAdded:e.addFormDatas}})],1)],1),a("q-dialog",{attrs:{persistent:""},model:{value:e.showConfirm,callback:function(t){e.showConfirm=t},expression:"showConfirm"}},[a("q-card",[a("q-card-section",{staticClass:"row items-center"},[a("q-icon",{attrs:{size:"5vh",name:"info_outline",color:"primary"}}),a("span",{staticClass:"q-ml-sm"},[e._v("Confirmez-vous cette demande ?")])],1),a("q-card-actions",{attrs:{align:"right"}},[a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{label:"Annuler",color:"negative"}}),a("q-btn",{attrs:{label:"Confimer",color:"primary"},on:{click:e.confirmDatas}})],1)],1)],1),a("q-dialog",{attrs:{persistent:""},model:{value:e.showSendMail,callback:function(t){e.showSendMail=t},expression:"showSendMail"}},[a("q-card",[a("q-card-section",{staticClass:"row items-center"},[a("q-icon",{attrs:{size:"5vh",name:"done",color:"secondary"}}),a("span",{staticClass:"q-ml-sm"},[e._v("Un E-mail de confirmation à été envoyé aux administrateurs")])],1),a("q-card-actions",{attrs:{align:"right"}},[a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{label:"Fermer",color:"primary"},on:{click:function(t){e.showSendMail=!1}}})],1)],1)],1)],1)},r=[],s=a("278c"),o=a.n(s),i=a("c973"),c=a.n(i),l=a("ded3"),m=a.n(l),d=(a("96cf"),a("cca6"),a("a15b"),a("d81d"),a("4de4"),a("d3b7"),a("4fadc"),a("99af"),a("ac1f"),a("ed09")),u=a("2f62"),f=(a("bd4c"),a("cf57")),p=a("9c40"),h=(a("05c0"),a("afe2"),a("9ef0")),b=Object(d["d"])({components:{FVvFormByName:h["a"]},data:function(){return{currentUser:{},saveFields:{},showConfirm:!1,showSendMail:!1}},computed:m()(m()(m()({},Object(u["d"])("admin",{formData:function(e){return e.getform},ftemplates:function(e){return e.ftemplates},template:function(e){return e.template}})),Object(u["d"])("adinfos",{isAdmin:function(e){return e.isAdmin},isSiteAdmin:function(e){return e.isSiteAdmin},grpUser:function(e){return e.userGrpes},users:function(e){return e.users}})),{},{currentUsername:function(){return console.log("Root :",this.$store),this.$store.state.auth.user.sAMAccountName}}),methods:m()(m()(m()({},Object(u["b"])("adinfos",["getRole"])),Object(u["b"])("admin",["getAllVisiteurs","addVisiteur","getForm","getTemplate","getFormByName","saveForm","getConfig","writeConfig","sendMail"])),{},{addFormDatas:function(e){this.showConfirm=!0,this.saveFields=Object.assign({},e),console.log("Valeur des champs :",this.saveFields)},confirmDatas:function(){var e=this;return c()(regeneratorRuntime.mark((function t(){var a,n,r,s,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.$q.loading.show({spinner:f["a"],spinnerColor:"red",message:"Chargement en cours..."}),console.log("Valeur des champs :",e.saveFields),console.log("Champs du formulaire :",e.formData),console.log("Utilisateur connecté :",e.$store.state.auth),a=e.formData[0].data.filter((function(e){return Object(e).hasOwnProperty("id")&&Object(e).hasOwnProperty("label")})).map((function(t){return e.saveFields[t.id]?Array.isArray(e.saveFields[t.id])?"<b>".concat(t.label," : </b><br>")+e.saveFields[t.id].map((function(e){return Object.entries(e).map((function(e){var t=o()(e,2),a=t[0],n=t[1];return"<b>".concat(a," :</b>").concat(n,"<br>")})).join("")})).join(""):"<b>".concat(t.label," : </b>").concat(e.saveFields[t.id],"<br>"):"<br>"})).join(""),n=e.$store.state.auth.user.mail,r=/\((.*)\)/gm,s=r.exec(e.saveFields["contactinterne"])[1],console.log("Envoi au contact interne :",s),console.log("Envoi au utilisateur :",n),i={to:"pascal.deleray@cacem-mq.com,parcauto@cacem.fr,alex.hibade@cacem-mq.com,admindsi@cacem-mq.com,".concat(n,",").concat(s),subject:"Demande de Réservation Parking ",message:"".concat(a)},console.log("Envoi au msg :",i),t.next=14,e.addVisiteur(e.saveFields);case 14:return t.next=16,e.sendMail(i);case 16:e.$q.loading.hide(),e.showConfirm=!1,e.showSendMail=!0;case 19:case"end":return t.stop()}}),t)})))()}}),beforeMount:function(){var e=this;return c()(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.$store.state.auth.user&&(e.currentUser=e.$store.state.auth.user),console.log("Profil :",e.currentUser),t.next=4,e.getFormByName("Demande Parking");case 4:console.log("Champs du formulaire :",e.formData);case 5:case"end":return t.stop()}}),t)})))()},mounted:function(){}}),g=b,v=a("2877"),w=a("9989"),q=a("f09f"),C=a("65c6"),F=a("6ac5"),y=a("a370"),j=a("24e8"),x=a("0016"),k=a("4b7e"),A=a("7f67"),D=a("eebe"),O=a.n(D),S=Object(v["a"])(g,n,r,!1,null,null,null);t["default"]=S.exports;O()(S,"components",{QPage:w["a"],QCard:q["a"],QToolbar:C["a"],QToolbarTitle:F["a"],QBtn:p["a"],QCardSection:y["a"],QDialog:j["a"],QIcon:x["a"],QCardActions:k["a"]}),O()(S,"directives",{ClosePopup:A["a"]})}}]);
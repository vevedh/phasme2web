(this["webpackJsonp"]=this["webpackJsonp"]||[]).push([[16],{"211c":function(e,t,a){"use strict";a.r(t);var o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("q-page",{staticClass:"vertical-top q-pa-md row items-top justify-center full-width"},[a("q-card",{staticStyle:{width:"80%","max-width":"100%"}},[a("q-toolbar",{staticClass:"text-white full-width bg-blue"},[a("q-toolbar-title",{staticClass:"text-h5"},[e._v(e._s(e.formNom)+" ! ")])],1),a("q-card-section",{staticClass:"q-pa-md"},[e.notLoaded?a("div",[e._v("Chargement en cours...")]):e._e(),a("div"),a("f-vv-form",{ref:"demandeParkingForm",staticClass:"q-pa-sm",attrs:{idForm:e.fid,fieldsmodel:e.getFieldsModel,showSave:!0,showBuild:e.showEditBtn},on:{onFormAdded:e.submitForm,formLoaded:e.onLoaded}})],1)],1),a("q-dialog",{attrs:{persistent:""},model:{value:e.showConfirm,callback:function(t){e.showConfirm=t},expression:"showConfirm"}},[a("q-card",[a("q-card-section",{staticClass:"row items-center"},[a("q-icon",{attrs:{size:"5vh",name:"info_outline",color:"primary"}}),a("span",{staticClass:"q-ml-sm"},[e._v("Confirmez-vous : "+e._s(e.formNom)+" ?")])],1),a("q-card-actions",{attrs:{align:"right"}},[a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{label:"Annuler",color:"negative"}}),a("q-btn",{attrs:{label:"Confimer",color:"primary"},on:{click:e.confirmDatas}})],1)],1)],1),a("q-dialog",{attrs:{persistent:""},model:{value:e.showSendMail,callback:function(t){e.showSendMail=t},expression:"showSendMail"}},[a("q-card",[a("q-card-section",{staticClass:"row items-center"},[a("q-icon",{attrs:{size:"5vh",name:"done",color:"secondary"}}),a("span",{staticClass:"q-ml-sm"},[e._v("Un E-mail de confirmation à été envoyé aux administrateurs")])],1),a("q-card-actions",{attrs:{align:"right"}},[a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{label:"Fermer",color:"primary"},on:{click:function(t){e.showSendMail=!1}}})],1)],1)],1)],1)},n=[],r=a("278c"),s=a.n(r),i=a("c973"),c=a.n(i),l=a("ded3"),m=a.n(l),d=(a("96cf"),a("cca6"),a("a15b"),a("d81d"),a("4de4"),a("d3b7"),a("4fadc"),a("99af"),a("ac1f"),a("4160"),a("159b"),a("afe2"),a("ed09")),u=a("2f62"),f=(a("bd4c"),a("cf57")),h=a("9c40"),g=(a("05c0"),a("7596")),p=Object(d["d"])({name:"PageForm",components:{FVvForm:g["a"]},data:function(){return{formID:"",notLoaded:!0,saveFields:{},fieldsmodel:{},showConfirm:!1,showSendMail:!1,showEditBtn:!1,state:{},valid:!1}},computed:m()(m()({},Object(u["d"])("admin",{formData:function(e){return e.getform},fconfig:function(e){return e.config},ftemplates:function(e){return e.ftemplates},template:function(e){return e.template}})),{},{fid:function(){return this.formID},currentUsername:function(){return console.log("Root :",this.$store),this.$store.state.auth.user.sAMAccountName},usermail:function(){if(this.$store.state.auth.user.mail)return this.$store.state.auth.user.mail},formNom:function(){try{return this.formData[0].nom}catch(e){return}},getFieldsModel:function(){if(this.fieldsmodel)return this.fieldsmodel}}),methods:m()(m()({},Object(u["b"])("admin",["getAllVisiteurs","addVisiteur","addDatasForm","getTemplate","getForm","saveForm","getConfig","writeConfig","sendMail"])),{},{onLoaded:function(e){e&&Array.isArray(e)&&(this.notLoaded=!1)},submitForm:function(e){console.log("Save datas for form ID :",this.formID),console.log("Valeurs :",e),this.addFormDatas(e)},onInput:function(e,t){this.$set(this.model,t,e)},onClick:function(e,t){this.$set(this.model,t,e),console.log("Close"),console.log("Element :",document.getElementsByClassName("q-menu")),document.getElementsByClassName("q-menu")[0].remove()},addFormDatas:function(e){this.showConfirm=!0,this.saveFields=Object.assign({},this.fieldsmodel,e),console.log("Save Valeur des champs :",this.saveFields)},confirmDatas:function(){var e=this;return c()(regeneratorRuntime.mark((function t(){var a,o,n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return console.log("Valeur des champs :",e.saveFields),e.$q.loading.show({spinner:f["a"],spinnerColor:"red",message:"Chargement en cours..."}),o=e.formData[0].data.filter((function(e){return Object(e).hasOwnProperty("id")&&Object(e).hasOwnProperty("label")})).map((function(t){return e.saveFields[t.id]?Array.isArray(e.saveFields[t.id])?"<b>".concat(t.label," : </b><br>")+e.saveFields[t.id].map((function(e){return Object.entries(e).map((function(e){var t=s()(e,2),a=t[0],o=t[1];return"<b>".concat(a," :</b>").concat(o,"<br>")})).join("")})).join(""):"<b>".concat(t.label," : </b>").concat(e.saveFields[t.id],"<br>"):"<br>"})).join(""),"Demande d'accès Parking"==e.formData[0].nom?(n=/\((.*)\)/gm,r=n.exec(e.saveFields["contactinterne"])[1],console.log("Envoi au contact interne :",r),console.log("Envoi utilisateur :",e.usermail),a={to:"pascal.deleray@cacem-mq.com,parcauto@cacem.fr,alex.hibade@cacem-mq.com,admindsi@cacem-mq.com,".concat(e.usermail,",").concat(r),subject:"Demande d'accès Parking ",message:"".concat(o)}):a={to:"admindsi@cacem-mq.com,".concat(usermail),subject:"".concat(e.formData[0].nom," "),message:"".concat(o)},console.log("Form save datas :",e.saveFields),console.log("Form dbname:",e.formData[0].dbname),console.log("Form tablename:",e.formData[0].tablename),t.next=10,e.addDatasForm({fields:e.saveFields,dbname:e.formData[0].dbname,tablename:e.formData[0].tablename});case 10:return t.next=12,e.sendMail(a);case 12:e.$q.loading.hide(),e.showConfirm=!1,e.showSendMail=!0;case 15:case"end":return t.stop()}}),t)})))()}}),beforeMount:function(){var e=this;return c()(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(console.log("Parms ID :",e.$route.params.id),e.formID=e.$route.params.id,""==e.formID){t.next=9;break}return t.next=5,e.getForm(e.formID);case 5:e.currentUsername==e.$store.state.admin.getform[0].user&&(e.showEditBtn=!0),console.log("Données du formulaire chargée :",e.formData),e.formData&&1==e.formData.length&&Object(e.formData[0]).hasOwnProperty("data")&&(a=e.formData[0].data.filter((function(e){return e.innerValue&&""!=e.innerValue})),console.log("Field form default values :",a),a&&Array.isArray(a)&&a.length>0&&(e.fieldsmodel={},a.forEach((function(t,a){e.fieldsmodel["".concat(t.id)]=t.innerValue})))),console.log("Field model :",e.fieldsmodel);case 9:case"end":return t.stop()}}),t)})))()},mounted:function(){console.log("Form user :",this.$store.state.admin.getform),console.log("Login user :",this.currentUsername)}}),b=p,v=(a("d689"),a("2877")),w=a("9989"),F=a("f09f"),D=a("65c6"),q=a("6ac5"),C=a("a370"),y=a("24e8"),j=a("0016"),x=a("4b7e"),k=a("4e73"),M=a("7f67"),$=a("eebe"),A=a.n($),O=Object(v["a"])(b,o,n,!1,null,null,null);t["default"]=O.exports;A()(O,"components",{QPage:w["a"],QCard:F["a"],QToolbar:D["a"],QToolbarTitle:q["a"],QCardSection:C["a"],QDialog:y["a"],QIcon:j["a"],QCardActions:x["a"],QBtn:h["a"],QMenu:k["a"]}),A()(O,"directives",{ClosePopup:M["a"]})},a634:function(e,t,a){},d689:function(e,t,a){"use strict";a("a634")}}]);
(this["webpackJsonp"]=this["webpackJsonp"]||[]).push([[15],{"428a":function(e,t,n){"use strict";n.r(t);var o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"container full-height"},[n("q-toolbar",{staticClass:"bg-primary text-white q-pa-sm q-gutter-md full-width"},[n("q-btn",{attrs:{flat:"",round:"",dense:"",icon:"assignment_ind"}}),n("q-toolbar-title",[e._v(" Email modèle création... ")]),n("q-btn",{attrs:{color:"white","no-caps":"",outline:"",label:"definir par défaut",icon:e.isDefault?"done":""},on:{click:e.lierAuFormulaire}}),n("q-select",{staticClass:"bg-white rounded-borders",attrs:{dense:"",outlined:"",options:e.listTemplates,"option-value":function(e){return null===e?null:e.id},"option-label":function(e){return null===e?"Null value":e.id}},on:{input:e.templateChange},model:{value:e.currentuid,callback:function(t){e.currentuid=t},expression:"currentuid"}}),n("q-input",{staticClass:"bg-white text-dark outlined rounded-borders q-pa-xs",staticStyle:{width:"100%","max-width":"300px"},attrs:{dense:"",label:"Email test :"},model:{value:e.email,callback:function(t){e.email=t},expression:"email"}}),n("q-btn",{staticClass:"q-mr-xs",attrs:{flat:"",round:"",dense:"",icon:"home",to:"/"}}),n("q-btn",{attrs:{flat:"",round:"",dense:"",icon:"more_vert"}})],1),n("div",{staticStyle:{"max-height":"100%",height:"0",width:"100%",overflow:"hidden"},attrs:{id:"gjs"}})],1)},a=[],r=n("9523"),i=n.n(r),l=n("c973"),s=n.n(l),d=n("ded3"),c=n.n(d),u=(n("96cf"),n("d81d"),n("4de4"),n("d3b7"),n("cca6"),n("7db0"),n("4160"),n("159b"),n("ac1f"),n("5319"),n("23b2"),n("1732"),n("cf57")),m=(n("98c5"),n("a826")),f=n.n(m),p=n("aa2d"),g=n.n(p),h=n("e736"),b=n.n(h),v=n("a93a"),j=n.n(v),x=n("2f62"),w=(n("5494"),{name:"EmailBuilder",data:function(){return{msg:"Welcome to Your Vue.js App",formID:null,editor:null,newuid:null,currentuid:null,defaultId:null,listTemplates:[],email:"herve.dechavigny@cacem.fr"}},computed:c()(c()({},Object(x["d"])("admin",{formData:function(e){return e.getform},fconfig:function(e){return e.config},ftemplates:function(e){return e.ftemplates},template:function(e){return e.template}})),{},{getId:function(){if(this.currentuid)return this.currentuid.id},isDefault:function(){return!!this.defaultId},formFields:function(){if(this.formData[0].data)return this.formData[0].data.filter((function(e){return Object(e).hasOwnProperty("id")})).map((function(e){return"".concat(e.id)}))}}),methods:c()(c()({},Object(x["b"])("admin",["sendMail","getForm","updateForm","updateDatasForm","getTemplatesById","createTemplate","updateTemplate"])),{},{change:function(){this.$emit("change",this.editor.getHtml())},templateChange:function(e){console.log("Changement de template :",e)},lierAuFormulaire:function(){var e=this;return s()(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(console.log("Id :",e.currentuid),!e.currentuid||!e.currentuid.id){t.next=7;break}return e.defaultId=e.currentuid.id,t.next=5,e.updateForm(Object.assign({},e.formData[0],{templateid:e.currentuid.id}));case 5:console.log("Formulaire :",Object.assign({},e.formData[0],{templateid:e.currentuid.id})),e.ftemplates&&Array.isArray(e.ftemplates)&&-1!=e.ftemplates.find((function(t){return t._id==e.formData[0].templateid}))&&(e.defaultId=e.formData[0].templateid);case 7:case"end":return t.stop()}}),t)})))()}}),beforeMount:function(){var e=this;return s()(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.$q.loading.show({spinner:u["a"],spinnerColor:"red",message:"Chargement en cours..."}),console.log("Form ID :",e.$route.params.id),e.formID=e.$route.params.id,""==e.formID){t.next=24;break}return t.next=6,e.getForm(e.formID);case 6:return t.next=8,e.getTemplatesById(e.formID);case 8:if(console.log("Templates :",e.ftemplates),console.log("form templateid :",e.formData[0].templateid),console.log("Found :",-1!=e.ftemplates.find((function(t){return t._id==e.formData[0].templateid}))),e.ftemplates&&Array.isArray(e.ftemplates)&&e.ftemplates.find((function(t){return t._id==e.formData[0].templateid}))&&(e.defaultId=e.formData[0].templateid),console.log("Template par defaut :",e.defaultId),0!=e.ftemplates.length){t.next=21;break}return n={errors:[],fields:[],html:null,json:null,uid:e.formID},t.next=17,e.createTemplate(n);case 17:e.listTemplates.push({id:e.template._id}),e.currentuid=Object.assign({},{id:e.template._id}),t.next=24;break;case 21:e.listTemplates=Object.assign([],e.ftemplates.map((function(e){return{id:e._id}}))),console.log("Liste des templates :",e.listTemplates),e.currentuid=Object.assign({},e.listTemplates[0]);case 24:e.$q.loading.hide();case 25:case"end":return t.stop()}}),t)})))()},mounted:function(){var e=this,t=function(t){e.formFields.forEach((function(e){t.BlockManager.add("".concat(e),{label:"".concat(e),content:"<mj-text>{{".concat(e,"}}</mj-text>"),attributes:{class:"gjs-fonts gjs-f-text"}})}))};this.editor=f.a.init({fromElement:!0,container:"#gjs",height:this.$q.screen.height-50,components:"<mjml>\n       <mj-body></mj-body>\n     </mjml>",avoidInlineStyle:!0,i18n:{localeFallback:"fr",messages:{fr:g.a}},plugins:[b.a,t],pluginsOpts:i()({},b.a,{storageManager:{id:"gjs-",type:"local",autosave:!0,autoload:!0,stepsBeforeSave:1},preMJML:"",postMJML:"",overwriteExport:!0,resetBlocks:!1,resetStyleManager:!1,i18n:{fr:j.a}})}),console.log("editor components :",this.editor.getComponents()),console.log("Templates  :",this.ftemplates),this.ftemplates.length>0&&Object(this.ftemplates[0]).hasOwnProperty("mjml")&&(console.log("Templates :",this.ftemplates),console.log("Components :",this.editor),this.editor.setComponents(this.ftemplates[0].mjml),this.editor.refresh()),console.log("Editor codemanager :",this.editor.CodeManager),console.log("Editor html :",this.editor.html),this.editor.Panels.addButton("options",{id:"send-mail",className:"fa fa-paper-plane",command:function(t,n){console.log("Editor :",t.getHtml()),console.log("Sender :",n);var o=e.editor.runCommand("mjml-get-code").html;console.log("Editor HTML :",o),e.sendMail({to:"".concat(e.email),subject:"test",message:"".concat(o)}).then((function(){e.$q.dialog({message:"Message envoyé!"})}))["catch"]((function(){e.$q.dialog({message:"!! Message non envoyé!"})})),n&&n.set("active"),t.store()},attributes:{title:"Envoyé un mail de Test"}}),this.editor.on("run:export-template:before",(function(t){console.log("Sender ...",t),console.log("Convert ...",e.editor.store()),console.log("Convert ...",e.editor.storeData()),e.editor.store().html.replace("<body>","").replace("</body>",""),e.editor.storeData().html.replace("<body>","").replace("</body>","")})),this.editor.on("storage:start:store",function(){var t=s()(regeneratorRuntime.mark((function t(n){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(console.log("Plugins :",n),!e.editor||2!=e.editor.getConfig().plugins.length){t.next=7;break}return console.log("MJML :",e.editor.runCommand("mjml-get-code").html),console.log("Sauvegarde code html :",e.editor.getHtml()),console.log("Objet à sauvegarder :",c()(c()({},e.editor.runCommand("mjml-get-code")),{},{mjml:e.editor.getHtml(),uid:e.formID,fields:e.formFields,_id:e.currentuid.id})),t.next=7,e.updateTemplate(c()(c()({},e.editor.runCommand("mjml-get-code")),{},{mjml:e.editor.getHtml(),uid:e.formID,fields:e.formFields,_id:e.currentuid.id}));case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}}),y=w,D=(n("69f8"),n("2877")),C=n("65c6"),I=n("9c40"),T=n("6ac5"),k=n("ddd8"),q=n("27f9"),M=n("eebe"),F=n.n(M),O=Object(D["a"])(y,o,a,!1,null,null,null);t["default"]=O.exports;F()(O,"components",{QToolbar:C["a"],QBtn:I["a"],QToolbarTitle:T["a"],QSelect:k["a"],QInput:q["a"]})},"69f8":function(e,t,n){"use strict";n("a4e0")},a4e0:function(e,t,n){}}]);